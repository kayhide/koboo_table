(function(){var t;t=function(){function t(){this.items=ko.observableArray()}return t.prototype.update_items=function(){var o,r,e,n,s;for(this.update_sort(),this.update_filter(),r=t.all,this.current_sort&&(r=this.sort_items(r,this.current_sort,this.sort_down)),r=this.filter_items(r),this.items.removeAll(),s=[],e=0,n=r.length;n>e;e++)o=r[e],s.push(this.items.push(o));return s},t.prototype.sort_items=function(t,o,r){return t=t.sort(function(){return function(t,e){var n,s;return n=t[o],s=e[o],"number"==typeof n&&"number"==typeof s?n-s:"number"==typeof n?r?1:-1:"number"==typeof s?r?-1:1:String(n).localeCompare(String(s))}}(this)),r&&t.reverse(),t},t.prototype.filter_items=function(t){var o;return t=function(){var r,e,n;for(n=[],r=0,e=t.length;e>r;r++)o=t[r],this.filter(o)&&n.push(o);return n}.call(this)},t.prototype.filter=function(t){var o,r,e,n,s;for(o=!0,s=this.filters,e=0,n=s.length;n>e;e++)r=s[e],o=o&&r(t);return o},t.prototype.update_sort=function(){var t;return this.last_sort=this.current_sort,t=$(".sort-up,.sort-down"),this.current_sort=t.data("koboo-sort"),this.sort_down=t.hasClass("sort-down")},t.prototype.update_filter=function(){var t,o,r,e,n,s,i,a,u,l,f,d,h,c;for(i={},o={},h=$(".filter:checked"),u=0,f=h.length;f>u;u++)t=h[u],s=$(t).data("koboo-filter"),$(t).data("koboo-filter-gt")||$(t).data("koboo-filter-gte")||$(t).data("koboo-filter-lt")||$(t).data("koboo-filter-lte")?o[s]={gt:Number($(t).data("koboo-filter-gt")),gte:Number($(t).data("koboo-filter-gte")),lt:Number($(t).data("koboo-filter-lt")),lte:Number($(t).data("koboo-filter-lte"))}:(null==i[s]&&(i[s]=[]),i[s].push($(t).data("koboo-filter-text")||$(t).closest("label").text()));for(this.filters=function(){var t;t=[];for(s in i)a=i[s],a.length>0&&t.push(function(t,o){return function(r){return r[t].match(new RegExp(o.join("|")))}}(s,a));return t}(),n=function(){var t;t=[];for(s in o)r=o[s],t.push(function(t,o){return function(r){return(!o.gt||r[t]>o.gt)&&(!o.gte||r[t]>=o.gte)&&(!o.lt||r[t]<o.lt)&&(!o.lte||r[t]<=o.lte)}}(s,r));return t}(),c=[],l=0,d=n.length;d>l;l++)e=n[l],c.push(this.filters.push(e));return c},t}(),this.KobooViewModel=t}).call(this),function(){$(function(){var t;return t=$("[data-koboo-items]").data("koboo-items"),$.getJSON(t,function(t){return KobooViewModel.all=t.items,ko.dataFor(document.body).update_items()}),ko.applyBindings(new KobooViewModel),$("[data-koboo-sort]").addClass("sort"),$("[data-koboo-sort]").on("click",function(){var t;return t=$(this).hasClass("sort-up"),$(".sort-up,.sort-down").removeClass("sort-up").removeClass("sort-down"),$(this).addClass(t?"sort-down":"sort-up"),ko.dataFor(document.body).update_items()}),$("[data-koboo-filter]").addClass("filter"),$("[data-koboo-filter]").on("click",function(){return ko.dataFor(document.body).update_items()})})}.call(this);
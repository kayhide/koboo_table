(function(){var t;t=function(){function t(t){this.root=t,this.items=ko.observableArray(),this.all_items=[]}return t.prototype.update_items=function(){var t,o,r,e,s;for(this.update_sort(),this.update_filter(),o=this.all_items,this.current_sort&&(o=this.sort_items(o,this.current_sort,this.sort_down)),o=this.filter_items(o),this.items.removeAll(),s=[],r=0,e=o.length;e>r;r++)t=o[r],s.push(this.items.push(t));return s},t.prototype.sort_items=function(t,o,r){return t=t.sort(function(){return function(t,e){var s,i;return s=t[o],i=e[o],"number"==typeof s&&"number"==typeof i?s-i:"number"==typeof s?r?1:-1:"number"==typeof i?r?-1:1:String(s).localeCompare(String(i))}}(this)),r&&t.reverse(),t},t.prototype.filter_items=function(t){var o;return t=function(){var r,e,s;for(s=[],r=0,e=t.length;e>r;r++)o=t[r],this.filter(o)&&s.push(o);return s}.call(this)},t.prototype.filter=function(t){var o,r,e,s,i;for(o=!0,i=this.filters,e=0,s=i.length;s>e;e++)r=i[e],o=o&&r(t);return o},t.prototype.update_sort=function(){var t;return this.last_sort=this.current_sort,t=this.root.find(".sort-up,.sort-down"),this.current_sort=t.data("koboo-sort"),this.sort_down=t.hasClass("sort-down")},t.prototype.update_filter=function(){var t,o,r,e,s,i,n,a,l,u,f,d,h,b;for(n={},o={},h=this.root.find(".filter:checked"),l=0,f=h.length;f>l;l++)t=h[l],i=$(t).data("koboo-filter"),$(t).data("koboo-filter-gt")||$(t).data("koboo-filter-gte")||$(t).data("koboo-filter-lt")||$(t).data("koboo-filter-lte")?o[i]={gt:Number($(t).data("koboo-filter-gt")),gte:Number($(t).data("koboo-filter-gte")),lt:Number($(t).data("koboo-filter-lt")),lte:Number($(t).data("koboo-filter-lte"))}:(null==n[i]&&(n[i]=[]),n[i].push($(t).data("koboo-filter-text")||$(t).closest("label").text()));for(this.filters=function(){var t;t=[];for(i in n)a=n[i],a.length>0&&t.push(function(t,o){return function(r){return r[t].match(new RegExp(o.join("|")))}}(i,a));return t}(),s=function(){var t;t=[];for(i in o)r=o[i],t.push(function(t,o){return function(r){return(!o.gt||r[t]>o.gt)&&(!o.gte||r[t]>=o.gte)&&(!o.lt||r[t]<o.lt)&&(!o.lte||r[t]<=o.lte)}}(i,r));return t}(),b=[],u=0,d=s.length;d>u;u++)e=s[u],b.push(this.filters.push(e));return b},t}(),this.KobooViewModel=t}).call(this),function(){$(function(){var t,o,r,e,s,i,n,a,l;if($("[data-koboo-sort]").addClass("sort"),$("[data-koboo-sort]").on("click",function(){var t,o;return t=$(this).hasClass("sort-up"),$(this).closest(".koboo").find(".sort-up,.sort-down").removeClass("sort-up").removeClass("sort-down"),$(this).addClass(t?"sort-down":"sort-up"),null!=(o=$(this).closest(".koboo").data("koboo"))?o.update_items():void 0}),$("[data-koboo-filter]").addClass("filter"),$("[data-koboo-filter]").on("click",function(){var t;return null!=(t=$(this).closest(".koboo").data("koboo"))?t.update_items():void 0}),o=$("[data-koboo-items]"),1===o.length)r=new KobooViewModel($("body")),ko.applyBindings(r),r.root.addClass("koboo").data("koboo",r).data("koboo-items",o.data("koboo-items"));else if(o.length>1)for(e=0,i=o.length;i>e;e++)t=o[e],r=new KobooViewModel($(t)),ko.applyBindings(r,t),r.root.addClass("koboo").data("koboo",r);for(a=$(".koboo"),l=[],s=0,n=a.length;n>s;s++)t=a[s],l.push(function(t){var o;return o=$(t).data("koboo-items"),$.getJSON(o,function(o){return r=$(t).data("koboo"),r.all_items=o.items,r.update_items()})}(t));return l})}.call(this);